{{define "content"}}
<div class="row justify-content-center py-4">
    <div class="col-md-10">
        <div class="card shadow-sm border-0 shadow" style="border-top: 5px solid var(--zunda-green) !important;">
            <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                <h4 class="mb-0 fw-bold" style="color: var(--zunda-dark);">
                    <i class="bi bi-card-image me-2"></i>Panel - 台本からコマ画像生成
                </h4>
                <span class="badge bg-success text-white">JSON Input Mode</span>
            </div>
            <div class="card-body p-4 bg-white">
                <form action="/generate" method="POST">
                    <input type="hidden" name="command" value="panel">

                    <div class="mb-4">
                        <label class="form-label fw-bold">台本 JSON (MangaResponse JSON)</label>
                        <textarea name="input_text" class="form-control json-editor-area" rows="15"
                                  spellcheck="false"
                                  placeholder='{
  "title": "作品タイトル",
  "panels": [
    {
      "page": 1,
      "visual_anchor": "high quality, cinematic lighting...",
      "speaker_id": "character_id"
    }
  ]
}' required></textarea>
                        <div class="form-text mt-2 text-muted">
                            生成済みの台本JSONを貼り付けてください。<code>panels</code> 配列が含まれている必要があります。
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <label class="form-label fw-bold">対象パネル (Target Panel Indices)</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-secondary"><i class="bi bi-list-check"></i></span>
                                <input type="text" name="target_panels" class="form-control font-monospace-input border-secondary"
                                       placeholder="例: 0, 2, 4">
                            </div>
                            <div class="form-text mt-2">
                                <strong>指定したインデックスのコマのみ</strong>を生成します。空欄の場合は全件一斉に生成されます。
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-light border-start border-4 border-success mt-2 py-3 shadow-sm">
                        <div class="fw-bold mb-1 text-success small">
                            <i class="bi bi-info-circle-fill"></i> Image Generation Tip:
                        </div>
                        <p class="mb-0 small text-muted">
                            特定のコマだけを修正したい場合は、対象のインデックス（0から開始）を指定して実行すると効率的です。
                        </p>
                    </div>

                    <hr class="my-4 text-secondary opacity-25">

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm border-0 action-btn">
                            <i class="bi bi-play-circle-fill me-2"></i>パネル生成を開始する
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    /* エディタのスタイル設定 */
    .json-editor-area {
        font-family: 'Fira Code', 'Cascadia Code', Consolas, monospace !important;
        background-color: #1e1e1e !important;
        color: #e0e0e0 !important;
        line-height: 1.6;
        padding: 1.5rem;
        border: 1px solid #333 !important;
    }

    .json-editor-area::placeholder {
        color: #7db766 !important;
        opacity: 0.8;
    }

    .json-editor-area:focus {
        background-color: #1e1e1e !important;
        color: #ffffff !important;
        border-color: var(--zunda-green) !important;
        box-shadow: 0 0 0 0.25rem rgba(118, 188, 33, 0.25) !important;
    }

    /* 自動補完時の背景色設定 */
    .json-editor-area:-webkit-autofill,
    .json-editor-area:-webkit-autofill:hover,
    .json-editor-area:-webkit-autofill:focus {
        -webkit-text-fill-color: #e0e0e0 !important;
        -webkit-box-shadow: 0 0 0px 1000px #1e1e1e inset !important;
        transition: background-color 5000s ease-in-out 0s;
    }

    .font-monospace-input {
        font-family: 'Fira Code', monospace;
    }

    .action-btn {
        background-color: var(--zunda-green) !important;
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        background-color: var(--zunda-dark) !important;
        transform: translateY(-2px);
    }
</style>
{{end}}
